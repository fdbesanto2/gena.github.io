<!DOCTYPE html>
<html>
<head>
    <title>Hydro Model Builder</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>html, body, #map-canvas {
        height: 100%;
        margin: 0;
        padding: 0
    }</style>
    <script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=false&amp;v=3"></script>
</head>
<body>

<div id="map-canvas"></div>

<script>
    var markers = [];

    function initialize() {
        google.maps.visualRefresh = true;
        var mapDiv = document.getElementById('map-canvas');

        var map = new google.maps.Map(mapDiv, {
            center: new google.maps.LatLng(25, 0),
            zoom: 3,
            mapTypeId: google.maps.MapTypeId.SATELLITE
        });

        var basinsLayer = new google.maps.FusionTablesLayer({
            map: map,
            suppressInfoWindows: true,
            heatmap: {enabled: false},
            query: { select: "col15", from: "13dShZ5yGqCEqk3dsJvYEL3lsa1hEmpMRldxK7aSa" },
            options: { styleId: 5, templateId: 5 }
        });

        var basinsOutlineLayer = new google.maps.FusionTablesLayer({
            map: map,
            suppressInfoWindows: true,
            heatmap: {enabled: false},
            query: {}
        });

        var riversLayer = new google.maps.FusionTablesLayer({
            map: null,
            suppressInfoWindows: true,
            heatmap: { enabled: false },
            query: {
                select: "col4",
                from: "15-WpLuijWukjWsjUral2RFZXx0IR7j2lLTAi8lR9",
                where: ""
            },
            options: {
                styleId: 2,
                templateId: 2
            }
        });

        var riversLayerLarge = new google.maps.FusionTablesLayer({
            map: map,
            heatmap: { enabled: false },
            query: {
                select: "col6",
                from: "1H-x7VEzYLA6UBaKNxTT_iIO1N_PJwuucZvwbNw",
                where: ""
            },
            options: {
                styleId: 2,
                templateId: 2
            }
        });

        google.maps.event.addListener(map, 'zoom_changed', function() {
                    var zoomLevel = map.getZoom();

                    console.log(zoomLevel)

                    if (zoomLevel <= 1) {
                        basinsLayer.setOptions({query: {}});
                        basinsOutlineLayer.setOptions({query: {}});
                    } else if (zoomLevel > 1 && zoomLevel < 5) {
                        basinsLayer.setOptions({
                            query: { select: "col15", from: "13dShZ5yGqCEqk3dsJvYEL3lsa1hEmpMRldxK7aSa" },
                            options: { styleId: 5, templateId: 5 }
                        }); // level 3
                        basinsOutlineLayer.setOptions({query: {}});
                    } else if (zoomLevel >= 5 && zoomLevel < 7) {
                        basinsLayer.setOptions({
                            query: { select: "col15",from: "1FxGTqGlr_XTSOL8r1zp-PIOCO3S3_6i2gI-KQeQZ" },
                            options: { styleId: 2, templateId: 2 }
                        }); // level 4
                        basinsOutlineLayer.setOptions({
                            query: { select: "col15", from: "13dShZ5yGqCEqk3dsJvYEL3lsa1hEmpMRldxK7aSa" },
                            options: { styleId: 4, templateId: 4 }
                        });
                    } else if (zoomLevel >= 7) {
                        basinsLayer.setOptions({
                            query: { select: "col15", from: "1GdJzOuuAFwgcBl_hM75j6DZ83S2U1u9Z2LWJ8n_L" },
                            options: { styleId: 2, templateId: 2 }
                        }); // level 5
                        basinsOutlineLayer.setOptions({
                            query: { select: "col15", from: "1FxGTqGlr_XTSOL8r1zp-PIOCO3S3_6i2gI-KQeQZ" },
                            options: { styleId: 3, templateId: 3 }
                        });
                    }

                    if(zoomLevel >= 6) {
                        riversLayerLarge.setMap(map);
                        riversLayer.setMap(map);
                    } else if(zoomLevel <= 1) {
                        riversLayerLarge.setMap(null);
                        riversLayer.setMap(null);
                    } else {
                        riversLayerLarge.setMap(map);
                        riversLayer.setMap(null);
                    }
                }
        );

        function queryBasinByPoint(point, map) {
            var marker = new google.maps.Marker({
                position: point,
                map: map
            });
            markers.push(marker);
            map.panTo(point);
        }

        basinsLayer.addListener('click', function (e) {
            queryBasinByPoint(e.latLng, map);
        });
        basinsOutlineLayer.addListener('click', function (e) {
            queryBasinByPoint(e.latLng, map);
        });
        riversLayer.addListener('click', function (e) {
            queryBasinByPoint(e.latLng, map);
        });
    }

    google.maps.event.addDomListener(window, 'load', initialize);
</script>

</body>
</html>